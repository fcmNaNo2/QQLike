services:
  # ========== 小号1 ==========
  # 这是你的第一个小号QQ，用来给主号点赞
  napcat-account1:
    image: mlikiowa/napcat-docker:latest
    container_name: napcat_account1
    ports:
      - "6099:6099"  # WebUI 登录端口，访问 http://localhost:6099/webui?token=xxx（token 见 napcat 日志）
      - "3000:3000"  # HTTP API 端口
      # - "3001:3001"  # WebSocket 端口（如需 WS 可取消注释）
    environment:
      # 文件权限（建议与宿主机用户一致，避免持久化目录权限问题）
      - NAPCAT_UID=${NAPCAT_UID:-1000}
      - NAPCAT_GID=${NAPCAT_GID:-1000}
      - ACCOUNT=${ACCOUNT_1}  # 【必改】替换为你的小号1的QQ号，在 .env 中配置
      # OneBot11 默认配置模板（用于生成 onebot11_<uin>.json）
      - MODE=qqlike
    volumes:
      # QQ 登录数据（不挂载会导致重启后需要重新扫码登录）
      - ./napcat_data/account1/qq:/app/.config/QQ
      # NapCat 配置
      - ./napcat_data/account1/config:/app/napcat/config
      # OneBot11 模板（入口脚本会拷贝到 /app/napcat/config/onebot11.json）
      - ./napcat_templates/qqlike.json:/app/templates/qqlike.json:ro
    restart: unless-stopped
    networks:
      - qq_bot_network

  # 小号1的点赞机器人 - 自动给主号点赞
  like-bot1:
    build: .
    container_name: like_bot_1
    ports:
      - "127.0.0.1:8088:8080"  # 点赞管理页面（仅本机访问）：http://localhost:8088
    environment:
      - ADMIN_ENABLE=true
      - ADMIN_HOST=0.0.0.0
      - ADMIN_PORT=8080
      - ADMIN_PUBLIC_URL=http://localhost:8088
      - STATE_FILE=/app/data/state.json
      - SCHEDULE_ENABLED=true
      - API_URL=http://napcat-account1:3000
      - ACCESS_TOKEN=${ACCESS_TOKEN}
      - TARGET_FRIENDS=${TARGET_FRIENDS}  # 【必改】你的主号QQ（被点赞的账号），在 .env 中配置
      - LIKE_TIMES=${LIKE_TIMES:-10}
      - SCHEDULE_TIME=${SCHEDULE_TIME:-09:00}
      - DELAY=${DELAY:-2}
    volumes:
      - ./like_bot_data/account1:/app/data
      - ./qq_auto_like_bot.py:/app/qq_auto_like_bot.py:ro
    depends_on:
      - napcat-account1
    restart: unless-stopped
    networks:
      - qq_bot_network

  # 统一点赞管理页面（聚合多个 like-bot 的状态/开关/手动执行）
  like-manager:
    build: .
    container_name: like_manager
    command: ["python", "-u", "like_manager.py"]
    ports:
      - "127.0.0.1:8099:8090"  # 统一管理页：http://localhost:8099
    environment:
      - MANAGER_HOST=0.0.0.0
      - MANAGER_PORT=8090
      # 这里列出要聚合的 like-bot（可按需增删 / 取消注释）
      - LIKE_BOTS=like-bot1=http://like-bot1:8080,like-bot2=http://like-bot2:8080,like-bot3=http://like-bot3:8080,like-bot4=http://like-bot4:8080,like-bot5=http://like-bot5:8080
    volumes:
      - ./like_manager.py:/app/like_manager.py:ro
      - ./qq_auto_like_bot.py:/app/qq_auto_like_bot.py:ro
    depends_on:
      - like-bot1
      - like-bot2
      - like-bot3
      - like-bot4
      - like-bot5
    restart: unless-stopped
    networks:
      - qq_bot_network

  # NapCat 退登自动尝试重登（实现方式：检测退登后，5分钟重启对应 NapCat 容器）
  # 注意：需要挂载 docker.sock，等同于容器拥有 Docker 控制权限，仅建议本机自用。
  napcat-watchdog:
    build: .
    container_name: napcat_watchdog
    command: ["python", "-u", "napcat_watchdog.py"]
    environment:
      - CHECK_INTERVAL=30
      - RELOGIN_DELAY=300
      - HTTP_TIMEOUT=5
      - WATCH_ITEMS=like-bot1|napcat_account1,like-bot2|napcat_account2,like-bot3|napcat_account3,like-bot4|napcat_account4,like-bot5|napcat_account5
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./napcat_watchdog.py:/app/napcat_watchdog.py:ro
    depends_on:
      - like-bot1
      - like-bot2
      - like-bot3
      - like-bot4
      - like-bot5
      - napcat-account1
      - napcat-account2
      - napcat-account3
      - napcat-account4
      - napcat-account5
    restart: unless-stopped
    networks:
      - qq_bot_network

  # ========== 小号2（取消注释以启用）==========
  # 如果你有第二个小号，取消下面的注释
  
  napcat-account2:
    image: mlikiowa/napcat-docker:latest
    container_name: napcat_account2
    ports:
      - "6100:6099"  # WebUI 登录端口，访问 http://localhost:6100/webui
      - "3001:3000"
      # - "3002:3001"
    environment:
      - NAPCAT_UID=${NAPCAT_UID:-1000}
      - NAPCAT_GID=${NAPCAT_GID:-1000}
      - ACCOUNT=${ACCOUNT_2}  # 小号2，在 .env 中配置
      - MODE=qqlike
    volumes:
      - ./napcat_data/account2/qq:/app/.config/QQ
      - ./napcat_data/account2/config:/app/napcat/config
      - ./napcat_templates/qqlike.json:/app/templates/qqlike.json:ro
    restart: unless-stopped
    networks:
      - qq_bot_network

  like-bot2:
    build: .
    container_name: like_bot_2
    environment:
      - ADMIN_ENABLE=true
      - ADMIN_HOST=0.0.0.0
      - ADMIN_PORT=8080
      - STATE_FILE=/app/data/state.json
      - SCHEDULE_ENABLED=true
      - API_URL=http://napcat-account2:3000
      - ACCESS_TOKEN=${ACCESS_TOKEN}
      - TARGET_FRIENDS=${TARGET_FRIENDS}
      - LIKE_TIMES=${LIKE_TIMES:-10}
      - SCHEDULE_TIME=${SCHEDULE_TIME_2:-09:05}  # 错开时间，避免同时点赞
      - DELAY=${DELAY:-2}
    volumes:
      - ./like_bot_data/account2:/app/data
      - ./qq_auto_like_bot.py:/app/qq_auto_like_bot.py:ro
    depends_on:
      - napcat-account2
    restart: unless-stopped
    networks:
      - qq_bot_network

  # ========== 小号3（取消注释以启用）==========
  
  napcat-account3:
    image: mlikiowa/napcat-docker:latest
    container_name: napcat_account3
    ports:
      - "6101:6099"  # WebUI 登录端口，访问 http://localhost:6101/webui
      - "3002:3000"
      # - "3003:3001"
    environment:
      - NAPCAT_UID=${NAPCAT_UID:-1000}
      - NAPCAT_GID=${NAPCAT_GID:-1000}
      - ACCOUNT=${ACCOUNT_3}  # 小号3，在 .env 中配置
      - MODE=qqlike
    volumes:
      - ./napcat_data/account3/qq:/app/.config/QQ
      - ./napcat_data/account3/config:/app/napcat/config
      - ./napcat_templates/qqlike.json:/app/templates/qqlike.json:ro
    restart: unless-stopped
    networks:
      - qq_bot_network

  like-bot3:
    build: .
    container_name: like_bot_3
    environment:
      - ADMIN_ENABLE=true
      - ADMIN_HOST=0.0.0.0
      - ADMIN_PORT=8080
      - STATE_FILE=/app/data/state.json
      - SCHEDULE_ENABLED=true
      - API_URL=http://napcat-account3:3000
      - ACCESS_TOKEN=${ACCESS_TOKEN}
      - TARGET_FRIENDS=${TARGET_FRIENDS}
      - LIKE_TIMES=${LIKE_TIMES:-10}
      - SCHEDULE_TIME=${SCHEDULE_TIME_3:-09:10}  # 错开时间
      - DELAY=${DELAY:-2}
    volumes:
      - ./like_bot_data/account3:/app/data
      - ./qq_auto_like_bot.py:/app/qq_auto_like_bot.py:ro
    depends_on:
      - napcat-account3
    restart: unless-stopped
    networks:
      - qq_bot_network

  # ========== 小号4（取消注释以启用）==========
  napcat-account4:
    image: mlikiowa/napcat-docker:latest
    container_name: napcat_account4
    ports:
      - "6102:6099"  # WebUI 登录端口，访问 http://localhost:6102/webui
      - "3003:3000"
    environment:
      - NAPCAT_UID=${NAPCAT_UID:-1000}
      - NAPCAT_GID=${NAPCAT_GID:-1000}
      - ACCOUNT=${ACCOUNT_4}  # 小号4，在 .env 中配置
      - MODE=qqlike
    volumes:
      - ./napcat_data/account4/qq:/app/.config/QQ
      - ./napcat_data/account4/config:/app/napcat/config
      - ./napcat_templates/qqlike.json:/app/templates/qqlike.json:ro
    restart: unless-stopped
    networks:
      - qq_bot_network

  like-bot4:
    build: .
    container_name: like_bot_4
    environment:
      - ADMIN_ENABLE=true
      - ADMIN_HOST=0.0.0.0
      - ADMIN_PORT=8080
      - STATE_FILE=/app/data/state.json
      - SCHEDULE_ENABLED=true
      - API_URL=http://napcat-account4:3000
      - ACCESS_TOKEN=${ACCESS_TOKEN}
      - TARGET_FRIENDS=${TARGET_FRIENDS}
      - LIKE_TIMES=${LIKE_TIMES:-10}
      - SCHEDULE_TIME=${SCHEDULE_TIME_4:-09:15}
      - DELAY=${DELAY:-2}
    volumes:
      - ./like_bot_data/account4:/app/data
      - ./qq_auto_like_bot.py:/app/qq_auto_like_bot.py:ro
    depends_on:
      - napcat-account4
    restart: unless-stopped
    networks:
      - qq_bot_network

  # ========== 小号5（取消注释以启用）==========
  napcat-account5:
    image: mlikiowa/napcat-docker:latest
    container_name: napcat_account5
    ports:
      - "6103:6099"  # WebUI 登录端口，访问 http://localhost:6103/webui
      - "3004:3000"
    environment:
      - NAPCAT_UID=${NAPCAT_UID:-1000}
      - NAPCAT_GID=${NAPCAT_GID:-1000}
      - ACCOUNT=${ACCOUNT_5}  # 小号5，在 .env 中配置
      - MODE=qqlike
    volumes:
      - ./napcat_data/account5/qq:/app/.config/QQ
      - ./napcat_data/account5/config:/app/napcat/config
      - ./napcat_templates/qqlike.json:/app/templates/qqlike.json:ro
    restart: unless-stopped
    networks:
      - qq_bot_network

  like-bot5:
    build: .
    container_name: like_bot_5
    environment:
      - ADMIN_ENABLE=true
      - ADMIN_HOST=0.0.0.0
      - ADMIN_PORT=8080
      - STATE_FILE=/app/data/state.json
      - SCHEDULE_ENABLED=true
      - API_URL=http://napcat-account5:3000
      - ACCESS_TOKEN=${ACCESS_TOKEN}
      - TARGET_FRIENDS=${TARGET_FRIENDS}
      - LIKE_TIMES=${LIKE_TIMES:-10}
      - SCHEDULE_TIME=${SCHEDULE_TIME_5:-09:20}
      - DELAY=${DELAY:-2}
    volumes:
      - ./like_bot_data/account5:/app/data
      - ./qq_auto_like_bot.py:/app/qq_auto_like_bot.py:ro
    depends_on:
      - napcat-account5
    restart: unless-stopped
    networks:
      - qq_bot_network

  # ========== 小号6（取消注释以启用）==========
  # 如需第 6 个小号，可复制“小号5”的两段配置并改端口/目录/账号

networks:
  qq_bot_network:
    driver: bridge
